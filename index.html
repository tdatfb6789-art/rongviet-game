<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Game Cá Cược TimeSticks – Tài/Xỉu + Giftcode</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 40px; background-color: #f4f4f4; }
    button, input { padding: 10px 20px; margin: 10px; font-size: 16px; }
    .money { font-weight: bold; color: green; font-size: 20px; }
    #history { max-height: 200px; overflow-y: auto; background: #fff; padding: 10px; border: 1px solid #ccc; margin: 0 auto; width: 80%; }
    input[type="text"], input[type="number"] { width: 200px; }
    .giftbox { background: #fff; padding: 15px; border: 1px solid #ccc; width: 400px; margin: 20px auto; }
  </style>
</head>
<body>

  <h1>🎲 Game Cá Cược TimeSticks – Tài/Xỉu + Giftcode</h1>
  <p>Số dư: <span class="money" id="balance">0</span> VNĐ</p>

  <label for="betAmount">💸 Số tiền cược (VNĐ):</label>
  <input type="number" id="betAmount" min="1" value="1000000"><br>

  <button onclick="placeBet('tai')">Cược Tài</button>
  <button onclick="placeBet('xiu')">Cược Xỉu</button>
  <button onclick="resetGame()">🔄 Reset tiền</button>

  <h3 id="result"></h3>
  <p>TimeSticks: <span id="timestamp"></span></p>

  <h3>Lịch sử cược:</h3>
  <div id="history"></div>

  <div class="giftbox">
    <h3>🎁 Nhập Giftcode nhận 2,000,000,000 VNĐ</h3>
    <input type="text" id="giftcodeInput" placeholder="Nhập mã giftcode">
    <button onclick="redeemGiftcode()">Dùng mã</button>
    <p id="giftcodeMsg"></p>
  </div>

  <script>
    // Khởi tạo từ localStorage nếu có
    let balance = parseInt(localStorage.getItem('balance')) || 150000000;
    let history = JSON.parse(localStorage.getItem('history')) || [];

    const giftcodes = {
      "GIFT2025-01": true,
      "GIFT2025-02": true,
      "GIFT2025-03": true,
      "GIFT2025-04": true,
      "GIFT2025-05": true,
      "GIFT2025-06": true,
      "GIFT2025-07": true,
      "GIFT2025-08": true,
      "GIFT2025-09": true,
      "GIFT2025-10": true
    };
    // Load trạng thái giftcodes đã dùng từ localStorage
    const usedGift = JSON.parse(localStorage.getItem('usedGiftcodes')) || {};
    Object.keys(usedGift).forEach(code => {
      if (giftcodes.hasOwnProperty(code)) {
        giftcodes[code] = false;
      }
    });

    function saveState() {
      localStorage.setItem('balance', balance);
      localStorage.setItem('history', JSON.stringify(history));
      localStorage.setItem('usedGiftcodes', JSON.stringify(
        Object.keys(giftcodes).filter(code => !giftcodes[code])
        .reduce((obj, code) => { obj[code] = true; return obj; }, {})
      ));
    }

    function updateDisplay() {
      document.getElementById("balance").textContent = balance.toLocaleString();
      const historyBox = document.getElementById("history");
      historyBox.innerHTML = history.map(h => `<div>${h}</div>`).reverse().join("");
    }

    function placeBet(choice) {
      const betInput = document.getElementById("betAmount");
      const resultDisplay = document.getElementById("result");
      const timestampDisplay = document.getElementById("timestamp");

      let bet = parseInt(betInput.value);
      if (isNaN(bet) || bet <= 0) {
        alert("Nhập số tiền cược hợp lệ.");
        return;
      }
      if (bet > balance) {
        alert("Không đủ tiền để cược!");
        return;
      }

      const now = Date.now();
      const lastDigit = now % 10;

      let outcome = (lastDigit <= 5) ? 'xiu' : 'tai';
      let win = (choice === outcome);
      let message = `Kết quả: TimeSticks = ${lastDigit} ⇒ ${outcome.toUpperCase()} thắng<br>`;

      if (win) {
        const reward = Math.floor(bet * 2.4);
        balance += reward;
        message += `🎉 Bạn thắng! +${reward.toLocaleString()} VNĐ`;
        history.push(`✅ Thắng ${choice.toUpperCase()} +${reward.toLocaleString()}`);
      } else {
        balance -= bet;
        message += `😢 Bạn thua! -${bet.toLocaleString()} VNĐ`;
        history.push(`❌ Thua ${choice.toUpperCase()} -${bet.toLocaleString()}`);
      }

      resultDisplay.innerHTML = message;
      timestampDisplay.textContent = now;
      saveState();
      updateDisplay();
    }

    function resetGame() {
      if (confirm("Bạn có chắc muốn reset về 150 triệu?")) {
        balance = 150000000;
        history.push("🔄 Reset về 150,000,000 VNĐ");
        saveState();
        updateDisplay();
      }
    }

    function redeemGiftcode() {
      const code = document.getElementById("giftcodeInput").value.trim().toUpperCase();
      const msgBox = document.getElementById("giftcodeMsg");

      if (giftcodes[code]) {
        balance += 2000000000;
        giftcodes[code] = false;
        msgBox.innerHTML = `🎁 Nhận thành công 2,000,000,000 VNĐ từ giftcode: <b>${code}</b>`;
        history.push(`🎁 Giftcode ${code} +2,000,000,000 VNĐ`);
        saveState();
        updateDisplay();
      } else {
        msgBox.innerHTML = `❌ Giftcode không hợp lệ hoặc đã sử dụng.`;
      }
    }

    // Khi trang load
    updateDisplay();
  </script>
</body>
</html>
